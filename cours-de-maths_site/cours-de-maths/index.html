<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cours de Math√©matiques</title>
  <meta name="description" content="Cours, activit√©s, exercices et corrig√©s par niveau.">
  <style>
    :root { --fg:#0d1b2a; --link:#1d4ed8; --bg:#f7f7fb; }
    * { box-sizing:border-box; }
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial; color:var(--fg); background:var(--bg); }
    header { padding:2rem 1rem; background:white; border-bottom:1px solid #e5e7eb; }
    .container { max-width:960px; margin:0 auto; padding:0 1rem; }
    h1 { margin:0 0 .5rem; font-size:clamp(1.6rem, 2.5vw + 1rem, 2.4rem); }
    p.lead { margin:.25rem 0 0; color:#374151; }

    /* Cartes + grilles */
    nav, .grid { display:grid; gap:1rem; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); margin:1rem 0 2rem; }
    a.card, .card { display:block; padding:1.2rem 1rem; background:white; border:1px solid #e5e7eb; border-radius:14px; text-decoration:none; color:var(--fg); }
    a.card:hover, .card:hover { border-color:#cbd5e1; box-shadow:0 4px 20px rgba(0,0,0,.04); }
    .muted { color:#6b7280; font-size:.95rem; }
    footer { padding:2rem 1rem; color:#6b7280; }
    ul { margin:0; padding-left:1rem; }
    .note { background:#fff; border:1px dashed #e5e7eb; border-radius:12px; padding:1rem; }
    .small { font-size:.9rem }
    h3.section { margin:2.5rem 0 0.5rem; }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Cours de Math√©matiques</h1>
      <p class="lead">Site de cours de M. Mezouari ‚Äî contenus, exercices, corrig√©s et liens utiles.</p>
    </div>
  </header>

  <main class="container">
    <!-- Ta section existante : Acc√®s par niveau -->
    <h2>Acc√®s par niveau</h2>
    <nav>
      <a class="card" href="classes/5e/"><strong>5<sup>e</sup></strong><br><span class="muted">S√©ances, devoirs et ressources</span></a>
      <a class="card" href="classes/4e/"><strong>4<sup>e</sup></strong><br><span class="muted">S√©ances, devoirs et ressources</span></a>
      <a class="card" href="classes/3e/"><strong>3<sup>e</sup></strong><br><span class="muted">S√©ances, devoirs et ressources</span></a>
      <a class="card" href="classes/2nde/"><strong>2nde</strong><br><span class="muted">S√©ances, devoirs et ressources</span></a>
    </nav>

    <div class="note small">
      <p><strong>Note :</strong> Les informations <em>officielles</em> (devoirs not√©s, notes, absences) restent sur <strong>Pronote</strong>.
      Ici, vous trouvez le contenu de cours, les documents et les liens utiles.</p>
    </div>

    <!-- üîΩ Nouvelle section : Progressions g√©n√©r√©es automatiquement -->
    <h2 style="margin-top:2.5rem">Progressions (mise √† jour automatique)</h2>
    <div id="progressions"></div>
  </main>

  <footer class="container">
    ¬© 2025 ‚Äî Cours de Math√©matiques ‚Ä¢ H√©berg√© avec GitHub Pages.
    <div class="small muted">Derni√®re lecture des progressions : <span id="stamp">‚Äî</span></div>
  </footer>

  <script>
    (async function () {
      const hostStamp = document.getElementById('stamp');
      const root = document.getElementById('progressions');

      // On force le no-cache pour √©viter que GitHub Pages serve un vieux JSON
      const jsonURL = 'docs/progressions/_classes.json?t=' + Date.now();

      try {
        const res = await fetch(jsonURL, { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();

        // data = { "College": ["302","308","407","507"], "Lyc√©e": ["2nde_7"], ... }
        const etabs = Object.keys(data).sort((a,b) => a.localeCompare(b, 'fr'));

        if (etabs.length === 0) {
          root.innerHTML = "<p class='muted'>Aucune progression trouv√©e.</p>";
          return;
        }

        for (const etab of etabs) {
          const h = document.createElement('h3');
          h.className = 'section';
          h.textContent = etab;
          root.appendChild(h);

          const grid = document.createElement('div');
          grid.className = 'grid';

          for (const classe of data[etab].sort((a,b)=>a.localeCompare(b,'fr'))) {
            const a = document.createElement('a');
            a.className = 'card';
            a.href = `docs/progressions/${etab}/${classe}.html`;
            a.innerHTML = `<strong>${etab} ‚Äì ${classe}</strong><br><span class="muted">Voir la progression</span>`;
            grid.appendChild(a);
          }
          root.appendChild(grid);
        }

        hostStamp.textContent = new Date().toLocaleString('fr-FR', { hour12: false });
      } catch (e) {
        console.error('Chargement des progressions impossible :', e);
        root.innerHTML = "<p class='muted'>Impossible de charger les progressions pour le moment.</p>";
      }
    })();
  </script>
</body>
</html>
